<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Placeholder title{% endblock %} - Maths Visualisation</title>
    <link rel="stylesheet" href="../static/style.css">
    <link rel="shortcut icon" href="../static/images/favicon.ico">
    <!-- For topic resources only -->
    {% if resource is defined %}
    <link href="https://fonts.cdnfonts.com/css/latin-modern-math" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/diagramatics@1.5/css/diagramatics.css" rel="stylesheet">
    <script>
        MathJax = {
            tex: {inlineMath: {'[+]': [['$', '$']]}},
            options: {
                a11y: {
                backgroundOpacity: 0.2,
                },
            },
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script>
    {% endif %}
</head>
<body onload="loadContainer()">
    <!--The navigation bar at the top of the page-->
    <div class="nav" id="navBar">
        <div class="expand">
            {% if not user.is_authenticated %}
            <a href="/login" title="Log in to your account">Log in</a>
            <a href="/signup" title="Create an account">Create account</a>
            {% endif %}
            <a href="/settings" title="Settings page">Settings</a>
            <a href="/help" title="Help page">Help</a>
        </div>
        <button class="home" type="image" onclick="location.href='/'" title="Home page"></button>
        <button class="menu"title="Expand Menu" onclick="expandMenu()"><div class="menu-bar"></div><div class="menu-bar"></div><div class="menu-bar"></div></button>    
    </div>
    
    <!--Flash message handling-->
    <div style="overflow: hidden;">
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
            {% if category == "error" %}
            <div class="flash" style="background-color:var(--pink); color: var(--hl4);">
            {% elif category == "success" %}
            <div class="flash" style="background-color: var(--pc3); color: var(--hl4);">
            {% else %}
            <div class="flash" style="background-color: var(--hl1); color: var(--hl4);">
            {% endif %}
                <label style="padding-left: 16px; width: 85vw; hyphens: auto;">{{message}}</label>
                <button type="button" class="close" onclick="closeMessage(this.parentElement)" title="Close message">&times;</button>
            </div>
        {% endfor %}
    {% endif %}
    {% endwith %}
    </div>

    <!--The container for content in all other pages-->
    <div class="container" id="container">{% block content %}{% endblock %}</div>

    <!-- Scripts for all pages -->
    <script>
        const delay = ms => new Promise(res => setTimeout(res, ms));

        function expandMenu() {
            var nav = document.getElementById("navBar");
            if (nav.className === "nav") {
                nav.className += " responsive";
            } else {
                nav.className = "nav";
            }
        } 

        closeMessage = async (message) => {
            message.style.height = '0em';
            await delay(300)
            message.remove()
        }
        function loadContainer() {
            let container = document.getElementById("container")
            container.style.opacity = 1
            container.style.transform = "none"
            let firstPart = container.querySelector(".part")
            if (firstPart !== null) {
                firstPart.style.transition = "none"
                firstPart.style.height = "fit-content"
                firstPart.style.opacity = 1
            }
        }
    </script>
    <!-- Dark theme -->
    {% if session.get("darkTheme") %}
    <script>
        document.documentElement.style.setProperty('--bg', '#191724');
        document.documentElement.style.setProperty('--pc1', '#74b4bf');
        document.documentElement.style.setProperty('--pc2', '#56949f');
        document.documentElement.style.setProperty('--pc3', '#286983');
        document.documentElement.style.setProperty('--hl4', '#e0def4');
        document.documentElement.style.setProperty('--hl3', '#908caa');
        document.documentElement.style.setProperty('--hl2', '#6e6a86');
        document.documentElement.style.setProperty('--hl1', '#26233a');
        document.documentElement.style.setProperty('--pink', '#c4717b');
        document.documentElement.style.setProperty('--invert', '100%');
    </script>
    {% endif %}
    <!-- High contrast -->
    {% if session.get("highContrast") %}
    <script>
        document.documentElement.style.setProperty('--contrast', '2');
    </script>
    {% endif %}
</body>
</html>